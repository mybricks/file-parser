!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["file-parser"]=t():e["file-parser"]=t()}(this,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseFromRXUIFile=t.getJSONFromRXUIFile=t.getJSONFromModule=void 0;const n=r(1),o=r(4);function i(e){return n.toJSON(e)}t.getJSONFromModule=i,t.getJSONFromRXUIFile=function(e){return i(o.parse(e).mainModule)},t.parseFromRXUIFile=function(e){return o.parse(e)}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.toJSON=void 0;const u=i(r(2)),c=s(r(3));t.toJSON=function({slot:e,frame:t}){let r;const n=[],o={},i=e=>{if(e.comAry){const r=[];return e.comAry.forEach(e=>{if(!t){const t=e.runtime,r=t.def;n.find(e=>e.namespace===r.namespace&&e.version===r.version)||n.push(r),o[t.id]={def:r,title:t.title,model:t.model}}let s;e.slots&&(s={},e.slots.forEach(e=>{const t=i(e);t&&(s[e.id]=t)})),r.push({id:e.runtime.id,def:e.runtime.def,slots:s})}),{id:e.id,type:e.type,title:e.title,comAry:r,style:e.style}}};r=i(e);const s=[],p=[],a=[],d=[],f={},l={},y={},m={},h={},_=(e,t)=>{if(e.rels&&(f[`${t}-${e.hostId}`]=e.rels),e.proxyPin){const r=e.proxyPin.parent;if(0===r._type){const n=r.id;l[`${t}-${e.hostId}`]={type:"frame",frameId:n,pinId:e.proxyPin.hostId}}}if(e.proxyPinValue){const r=e.proxyPinValue.parent;if(0===r._type){const n=r.id;y[`${t}-${e.hostId}`]={type:"frame",frameId:n,pinId:e.proxyPinValue.hostId}}}},P=(e,t)=>{if(e.proxyPin){const r=e.proxyPin.parent;if(0===r._type){const n=r.id;l[`${t}-${e.hostId}`]={type:"frame",frameId:n,pinId:e.proxyPin.hostId}}}if(e.conAry){const r=[];if(e.conAry.forEach(e=>{var t,n,o,i,s;let u;const c=e.finishPin;if(!c)return;const p=e.parent.parent;p&&(u=p.parent?1===p.parent._type?`${p.parent.runtime.id}-${p.id}`:""+p.id:"_rootFrame_");const a=c.parent;if(1===a._type){const t=c.forkedFrom||c,n=a.forkedFrom||a,o=e.startPin.parent._key,i=e.finishPin.parent._key;r.push({type:"com",frameKey:u,startPinParentKey:o,finishPinParentKey:i,comId:n.runtime.id,def:n.runtime.def,pinId:t.hostId,pinType:t.type,direction:t.direction,extBinding:t.extBinding})}else{const p=c.forkedFrom||c,a=p.parent;if(0===a._type){const c=p.forkedAsJoint;if(c){const i=(null===(t=c.from)||void 0===t?void 0:t.hostId)||c.hostId,s={type:"frame",frameKey:u,startPinParentKey:null===(n=e.startPin.parent)||void 0===n?void 0:n._key,frameId:a.id,comId:null===(o=a.parent)||void 0===o?void 0:o.runtime.id,pinId:i,pinType:"joint",direction:c.direction};r.push(s);const p=`${s.comId?s.comId+"-":""}${s.frameId}`;P(c,p)}else{const t=null===(i=e.startPin.parent)||void 0===i?void 0:i._key,n=1===(null===(s=a.parent)||void 0===s?void 0:s._type)?a.parent.runtime.id:void 0;r.push({type:"frame",frameKey:u,startPinParentKey:t,frameId:a.id,comId:n,pinId:p.hostId,pinType:p.type,direction:p.direction})}}}}),r.length>0){let n;n=e.from&&e.from.hostId?e.from.hostId:e.hostId,m[`${t}-${n}`]=r}}},b=e=>{e._inputPins&&e._inputPins.forEach(t=>{let r;r=e.parent&&1===e.parent._type?`${e.parent.runtime.id}-${e.id}`:e.parent?e.id:"_rootFrame_",P(t,r),_(t,r),e.parent||s.push({id:t.hostId,title:t.title,type:t.type,schema:t.schema,extValues:t.extValues})}),e.inputPins&&e.inputPins.forEach(t=>{let r;r=e.parent&&1===e.parent._type?`${e.parent.runtime.id}-${e.id}`:e.parent?e.id:"_rootFrame_",P(t,r),_(t,r),e.parent||a.push({id:t.hostId,title:t.title,type:t.type,schema:t.schema,extValues:t.extValues})}),e._outputPins&&e._outputPins.forEach(t=>{e.parent||p.push({id:t.hostId,title:t.title,type:t.type,schema:t.schema})}),e.outputPins&&e.outputPins.forEach(t=>{if(e.parent||d.push({id:t.hostId,title:t.title,type:t.type,schema:t.schema}),"event"===t.type){P(t,"_rootFrame_")}}),e.comAry&&e.comAry.forEach(t=>{var r,i,s;const c=t.runtime,p=c.def;n.find(e=>e.namespace===p.namespace&&e.version===p.version)||n.push(p);const a=[],d=[],f=[],l=c.geo;if(o[c.id]={def:p,frameId:e.parent?e.id:void 0,parentComId:null===(i=null===(r=e.parent)||void 0===r?void 0:r.runtime)||void 0===i?void 0:i.id,title:c.title,model:c.model,reservedEditorAry:l?l.reservedEditorAry:void 0,configs:a,inputs:d,outputs:f},t.configPins&&t.configPins.forEach(e=>{a.push(e.hostId)}),u.each(e=>{_(e,c.id),d.push(e.hostId)},t.inputPins,t.inputPinsInModel,t.inputPinExts),u.each(e=>{P(e,c.id),f.push(e.hostId)},t.outputPins,t.outputPinsInModel,t.outputPinExts,t.outputPinNexts),c._autoRun&&(null===(s=p.rtType)||void 0===s?void 0:s.match(/^js/))){let t;t=e.parent?e.parent.runtime?`${e.parent.runtime.id}-${e.id}`:e.id:"_rootFrame_";let r=h[t];r||(r=h[t]=[]),r.push({id:c.id,def:p})}t.frames&&t.frames.forEach(e=>{b(e)})}),e.frameAry&&e.frameAry.forEach(e=>{b(e)})};return t&&b(t),{"-v":c.default.version,id:r.id,title:r.title,deps:n,coms:o,slot:r,comsAutoRun:h,_inputs:s,_outputs:p,inputs:a,outputs:d,cons:m,pinRels:f,pinProxies:l,pinValueProxies:y}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.length=t.merge=t.find=t.each=void 0,t.each=function(e,...t){t.forEach(t=>{t&&t.forEach((r,n)=>{e(r,n,t)})})},t.find=function(e,...t){let r;return t.find(t=>{if(t)return r=t.find(t=>e(t))}),r},t.merge=function(...e){let t=[];return e.forEach(e=>{t=t.concat(e)}),t},t.length=function(...e){let t=0;return e.forEach(e=>{Array.isArray(e)&&(t+=e.length)}),t}},function(e){e.exports=JSON.parse('{"name":"@mybricks/file-parser","version":"1.0.9","description":"Parser for rxui file content","main":"index.min.js","scripts":{"test":"ts-node --transpileOnly ./_test/index.ts","build":"webpack --config ./scripts/webpack.build.js"},"repository":{"type":"git","url":"https://github.com/mybricks/rxui.git"},"publishConfig":{"access":"public","registry":"https://registry.npmjs.org"},"author":"CheMingjun","license":"ISC","dependencies":{},"devDependencies":{"@babel/core":"^7.8.7","@babel/plugin-proposal-class-properties":"^7.8.3","@babel/preset-env":"^7.8.7","@babel/preset-react":"^7.8.3","@testing-library/react":"^11.2.5","@types/node":"^13.9.0","@types/react":"^18.0.21","@types/react-dom":"^18.0.6","babel-loader":"^8.0.6","core-js":"^2.6.11","jest":"^26.6.3","rimraf":"^2.6.2","ts-loader":"^6.2.1","ts-node":"^10.9.1","typescript":"^3.8.3","webpack":"^4.42.0","webpack-bundle-analyzer":"^3.6.1","webpack-cli":"^3.3.11"}}')},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=void 0;const n=r(5);let o,i;t.parse=function(e){let t;const r=[];for(let r in e)if(r===n.KEY_STAGEVIEW){t=s(e[r]).mainModule}const o=e=>{e.comAry&&e.comAry.forEach(e=>{const t=e.runtime.def;if(t){const e=t.namespace+"@"+t.version;r.indexOf(e)<=0&&r.push(e)}e.slots&&e.slots.forEach(e=>{o(e)})})};return t.slot.slots.forEach(e=>{o(e)}),{mainModule:{slot:t.slot.slots[0],frame:t.frame.frames[0]},requireComs:r}};function s(e){if("object"!=typeof e||"object"!=typeof e.def||"object"!=typeof e.refs)throw new Error("Invalid data format.");const{def:t,refs:r,D:s}=e;if(s)if(s.W){const e={};Object.keys(s.W).forEach(t=>{e[s.W[t]]=t}),s.W=e,o=s}else o=Object.assign({W:{}},s);else o={C:{},W:{}};i={refs:r,didMap:{}};return function e(t,r){const{refs:s,didMap:u}=i;if(Array.isArray(t))return t.map(t=>e(t));if("object"==typeof t&&t){if(t[n.META_HASHCODE])return u[t[n.META_HASHCODE]]=r||t,r||t;const i=t._R_;if("string"==typeof i){if(!r&&u[i])return u[i];t=s[i],u[i]=r||t}let c,p;(p=t._F_)&&(c=function(){}),delete t._F_;let a=function(e,t){let r=[];do{if(e==Object.prototype||e==Function.prototype)break;try{r=r.concat(Object.getOwnPropertyNames(e))}catch(e){console.error(e)}}while(e=Object.getPrototypeOf(e));return r.filter(r=>{if(!t||t&&"function"!=typeof e[r])return"constructor"!=r&&!/^__.+/g.test(r)})}(t);if(a.length>0){const r=t[n.META_IGNORE];a.forEach(i=>{let s=o.W[i],u=t[i];if(s?(t[i]=void 0,delete t[i]):s=i,i===n.META_IGNORE)return;const c=function(e,t){let r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){let n=e;for(;void 0===r&&null!=(n=Object.getPrototypeOf(n))&&n!==Object.prototype;)r=Object.getOwnPropertyDescriptor(n,t)}return r}(t,s);if(!(c&&c.get&&!c.set||r&&r[s]||r&&r[s])){r&&console.log(s);const n=e(u);try{t[s]=n}catch(e){throw e}}})}}return t}(t)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.META_IGNORE=t.META_HASHCODE=t.PIN_KEYS=t.KEY_REF=t.KEY_STAGEVIEW=void 0,t.KEY_STAGEVIEW="xg.desn.stageview",t.KEY_REF="_R_",t.PIN_KEYS=["inputPins","outputPins","inputPinExts","outputPinsInModel","inputPinsInModel","outputPinExts"],t.META_HASHCODE="_hc_",t.META_IGNORE="_ignore_"}])}));