!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["file-parser"]=t():e["file-parser"]=t()}(this,(function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&i(t,e,n);return o(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.toFrameJSON=t.toSlotJSON=t.toJSON=void 0;const d=r(n(1)),p=s(n(3));function a(e,{depsReg:t,comsReg:n},i,o){let r;const s=e=>{if(e.comAry){const r=[];e.comAry.forEach(e=>{if(!i){const i=e.runtime,r=i.def;t.find(e=>e.namespace===r.namespace&&e.version===r.version)||t.push(r);const s=o?JSON.parse(JSON.stringify(i.model)):i.model;n[i.id]={id:i.id,def:r,name:e.name,title:i.title,model:s}}let d;e.slots&&(d={},e.slots.forEach(e=>{const t=s(e);t&&(d[e.id]=t)})),r.push({id:e.runtime.id,name:e.name,def:e.runtime.def,slots:d})});const d=e.$el?e.$el.offsetWidth:e.width,p=e.$el?e.$el.offsetHeight:e.height,a=Object.assign({},e.style,{width:d,height:p});return{id:e.id,title:e.title,type:e.type,showType:e.showType,layoutTemplate:e.layoutTemplate,comAry:r,style:a}}};return e&&(r=s(e)),r}function u(e,t,n){const i=(null==t?void 0:t.depsReg)||[],o=(null==t?void 0:t.comsReg)||{},r=[],s=[],a=[],u=[],f={},l={},m={},y={},h={},I=(e,t)=>{if(e.rels&&(f[`${t}-${e.hostId}`]=e.rels),e.proxyScenePin){const{sceneId:n,hostId:i}=e.proxyScenePin;l[`${t}-${e.hostId}`]={type:"frame",frameId:n,pinId:i}}if(e.proxyPin)if(e.proxyPin._todo_){const{frameId:n,pinId:i,pinHostId:o}=e.proxyPin;l[`${t}-${e.hostId}`]={type:"frame",frameId:n,pinId:o}}else{const n=e.proxyPin.parent;if(n&&0===n._type){const i=n.id;l[`${t}-${e.hostId}`]={type:"frame",frameId:i,pinId:e.proxyPin.hostId}}}if(e.proxyPinValue){const n=e.proxyPinValue.parent;if(n&&0===n._type){const i=n.id;m[`${t}-${e.hostId}`]={type:"frame",frameId:i,pinId:e.proxyPinValue.hostId}}}},P=(e,t)=>{if(e.proxyPin)if(e.proxyPin._todo_){const{frameId:n,pinId:i,pinHostId:o}=e.proxyPin;l[`${t}-${e.hostId}`]={type:"frame",frameId:n,pinId:o}}else{const n=e.proxyPin.parent;if(n&&0===n._type){const i=n.id;l[`${t}-${e.hostId}`]={type:"frame",frameId:i,pinId:e.proxyPin.hostId}}}if(e.conAry){const n=[];if(e.conAry.forEach(e=>{var t,i,o,r,s;let d,p;const a=e.finishPin;if(!a)return;let u;a.parent,a.parent&&a.parent.timerInputPin&&(u=a.parent.timerInputPin.id);const f=e.parent.parent;f&&(d=c(f)),p=a.proxyPinValue?c(a.proxyPinValue.parent):d;const l=a.parent;if(1===(null==l?void 0:l._type)){const t=a.forkedFrom||a,i=l.forkedFrom||l;if(i&&i.runtime){const o=e.startPin.parent._key,r=e.finishPin.parent._key;n.push({id:e.id,type:"com",frameKey:d,targetFrameKey:p,startPinParentKey:o,finishPinParentKey:r,comId:i.runtime.id,def:i.runtime.def,timerPinInputId:u,pinId:t.hostId,pinType:t.type,direction:t.direction,extBinding:t.extBinding,isIgnored:e.isIgnored,isBreakpoint:e.isBreakpoint})}}else{const p=a.forkedFrom||a,u=p.parent;if(0===u._type){const a=p.forkedAsJoint;if(a){const r=(null===(t=a.from)||void 0===t?void 0:t.hostId)||a.hostId,s=null===(i=e.startPin.parent)||void 0===i?void 0:i._key,p={id:e.id,type:"frame",frameKey:d,startPinParentKey:s,frameId:u.id,comId:null===(o=u.parent)||void 0===o?void 0:o.runtime.id,pinId:r,pinType:"joint",direction:a.direction,isIgnored:e.isIgnored,isBreakpoint:e.isBreakpoint};n.push(p);const c=`${p.comId?p.comId+"-":""}${p.frameId}`;P(a,c)}else{const t=null===(r=e.startPin.parent)||void 0===r?void 0:r._key,i=1===(null===(s=u.parent)||void 0===s?void 0:s._type)?u.parent.runtime.id:void 0;n.push({id:e.id,type:"frame",frameKey:d,startPinParentKey:t,frameId:u.id,comId:i,pinId:p.hostId,pinType:p.type,direction:p.direction,isIgnored:e.isIgnored,isBreakpoint:e.isBreakpoint})}}}}),n.length>0){let i;i=e.from&&e.from.hostId?e.from.hostId:e.hostId,y[`${t}-${i}`]=n}}},_=e=>{e._inputPins&&e._inputPins.forEach(t=>{let n;n=e.parent&&1===e.parent._type?`${e.parent.runtime.id}-${e.id}`:e.parent?e.id:"_rootFrame_",P(t,n),I(t,n),e.parent||r.push({id:t.hostId,title:t.title,type:t.type,schema:t.schema,extValues:t.extValues})}),e.inputPins&&e.inputPins.forEach(t=>{let n;n=e.parent&&1===e.parent._type?`${e.parent.runtime.id}-${e.id}`:e.parent?e.id:"_rootFrame_",P(t,n),I(t,n),e.parent||a.push({id:t.hostId,title:t.title,type:t.type,schema:t.schema,extValues:t.extValues})}),e._outputPins&&e._outputPins.forEach(t=>{e.parent||s.push({id:t.hostId,title:t.title,type:t.type,schema:t.schema})}),e.outputPins&&e.outputPins.forEach(t=>{if(e.parent||u.push({id:t.hostId,title:t.title,type:t.type,schema:t.schema}),"event"===t.type){P(t,"_rootFrame_")}}),e.comAry&&e.comAry.forEach(t=>{var r,s,p;if("按钮1"===t.title&&"u_zJFoV"===t.id&&console.log(t.id),!t||!t.runtime)return;const a=t.runtime,u=a.def;i.find(e=>e.namespace===u.namespace&&e.version===u.version)||i.push(u);const c=[],f=[],l=[],m=[],y=a.geo;let g=n?JSON.parse(JSON.stringify(a.model)):a.model;a.modelForToJSON&&(g=Object.assign({},g,a.modelForToJSON),a.modelForToJSON=void 0);const v={};if(a.geo&&(v.width=a.geo.$el?a.geo.$el.offsetWidth:void 0,v.height=a.geo.$el?a.geo.$el.offsetHeight:void 0),o[a.id],o[a.id]={id:a.id,def:u,frameId:e.parent?e.id:void 0,parentComId:null===(s=null===(r=e.parent)||void 0===r?void 0:r.runtime)||void 0===s?void 0:s.id,title:a.title,model:g,style:v,reservedEditorAry:y?y.reservedEditorAry:void 0,constraints:y?y.constraints:void 0,configs:c,_inputs:f,timerInput:void 0,inputs:l,outputs:m},t.configPins&&t.configPins.forEach(e=>{c.push(e.hostId)}),t.timerInput&&(I(t.timerInput,a.id),o[a.id].timerInput=t.timerInput.hostId),d.each(e=>{I(e,a.id),f.push(e.hostId)},t._inputPins),d.each(e=>{I(e,a.id),l.push(e.hostId)},t.inputPins,t.inputPinsInModel,t.inputPinExts),d.each(e=>{P(e,a.id),m.push(e.hostId)},t.outputPins,t.outputPinsInModel,t.outputPinExts,t.outputPinNexts),a._autoRun&&(null===(p=u.rtType)||void 0===p?void 0:p.match(/^js/))){let t;t=e.parent?e.parent.runtime?`${e.parent.runtime.id}-${e.id}`:e.id:"_rootFrame_";let n=h[t];n||(n=h[t]=[]),n.push({id:a.id,def:u})}t.frames&&t.frames.forEach(e=>{_(e)})}),e.frameAry&&e.frameAry.forEach(e=>{_(e)})};return e&&_(e),{"-v":p.default.version,id:e.id,title:e.title,type:e.type,deps:i,coms:o,comsAutoRun:h,_inputs:r,_outputs:s,inputs:a,outputs:u,cons:y,pinRels:f,pinProxies:l,pinValueProxies:m}}function c(e){if(e)return e.parent?1===e.parent._type?`${e.parent.runtime.id}-${e.id}`:""+e.id:"_rootFrame_"}t.toJSON=function({slot:e,frame:t},n){const i=[],o={};let r,s;return e&&(r=a(e,{depsReg:i,comsReg:o},t,n)),t&&(s=u(t,{depsReg:i,comsReg:o},n)),Object.assign({"-v":p.default.version,deps:i,coms:o},s||{},r?{id:r.id,title:r.title,slot:r}:{})},t.toSlotJSON=a,t.toFrameJSON=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.length=t.merge=t.find=t.each=void 0,t.each=function(e,...t){t.forEach(t=>{t&&t.forEach((n,i)=>{e(n,i,t)})})},t.find=function(e,...t){let n;return t.find(t=>{if(t)return n=t.find(t=>e(t))}),n},t.merge=function(...e){let t=[];return e.forEach(e=>{t=t.concat(e)}),t},t.length=function(...e){let t=0;return e.forEach(e=>{Array.isArray(e)&&(t+=e.length)}),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseProject=t.parsePage=t.toJSONFromProjectDump=t.toJSONFromPageDump=t.getJSONFromModule=t.getGlobalJSON=void 0;const i=n(0),o=n(4),r=n(5);function s(e,t){return i.toJSON(e,t)}Object.defineProperty(t,"parsePage",{enumerable:!0,get:function(){return r.parsePage}}),Object.defineProperty(t,"parseProject",{enumerable:!0,get:function(){return r.parseProject}}),t.getGlobalJSON=function(e,t){return o.toJSON(e,t)},t.getJSONFromModule=s,t.toJSONFromPageDump=function(e){const t=JSON.parse(e).content;return s(r.parsePage(t))},t.toJSONFromProjectDump=function(e){let t;"string"==typeof e?t=JSON.parse(e):"object"==typeof e&&(t=e.projectContent);const n=r.parseProject(t),{mainModule:i,pluginDataset:o}=n;return s({slot:i.slot,frame:i.frame,pluginDataset:o})}},function(e){e.exports=JSON.parse('{"name":"@mybricks/file-parser","version":"1.0.17","description":"Parser for rxui file content","main":"index.min.js","scripts":{"test":"ts-node --transpileOnly ./_test/index.ts","build":"webpack --config ./scripts/webpack.build.js"},"repository":{"type":"git","url":"https://github.com/mybricks/rxui.git"},"publishConfig":{"access":"public","registry":"https://registry.npmjs.org"},"author":"CheMingjun","license":"ISC","dependencies":{},"devDependencies":{"@babel/core":"^7.8.7","@babel/plugin-proposal-class-properties":"^7.8.3","@babel/preset-env":"^7.8.7","@babel/preset-react":"^7.8.3","@testing-library/react":"^11.2.5","@types/node":"^13.9.0","@types/react":"^18.0.21","@types/react-dom":"^18.0.6","babel-loader":"^8.0.6","core-js":"^2.6.11","jest":"^26.6.3","rimraf":"^2.6.2","ts-loader":"^6.2.1","ts-node":"^10.9.1","typescript":"^3.8.3","webpack":"^4.42.0","webpack-bundle-analyzer":"^3.6.1","webpack-cli":"^3.3.11"}}')},function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&i(t,e,n);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.toJSON=void 0;const s=r(n(1)),d=n(0);t.toJSON=function(e,t){const n={},i={},o={},r={},p=[],a=(e,t)=>{if(e.rels&&(o[`${t}-${e.hostId}`]=e.rels),e.proxyPin)if(e.proxyPin._todo_){const{frameId:n,pinId:i,pinHostId:o}=e.proxyPin;r[`${t}-${e.hostId}`]={type:"frame",frameId:n,pinId:o}}else{const n=e.proxyPin.parent;if(n&&0===n._type){const i=n.id;r[`${t}-${e.hostId}`]={type:"frame",frameId:i,pinId:e.proxyPin.hostId}}}},u=(e,t)=>{if(e.proxyPin)if(e.proxyPin._todo_){const{frameId:n,pinId:i,pinHostId:o}=e.proxyPin;r[`${t}-${e.hostId}`]={type:"frame",frameId:n,pinId:o}}else{const n=e.proxyPin.parent;if(n&&0===n._type){const i=n.id;r[`${t}-${e.hostId}`]={type:"frame",frameId:i,pinId:e.proxyPin.hostId}}}if(e.conAry){const n=[];if(e.conAry.forEach(e=>{var t,i,o,r,s;let d;const p=e.finishPin;if(!p)return;let a;p.parent.timerInputPin&&(a=p.parent.timerInputPin.id);const c=e.parent.parent;c&&(d=c.parent?1===c.parent._type?`${c.parent.runtime.id}-${c.id}`:""+c.id:"_rootFrame_");const f=p.parent;if(1===f._type){const t=p.forkedFrom||p,i=f.forkedFrom||f,o=e.startPin.parent._key,r=e.finishPin.parent._key;n.push({id:e.id,type:"com",frameKey:d,startPinParentKey:o,finishPinParentKey:r,comId:i.runtime.id,def:i.runtime.def,timerPinInputId:a,pinId:t.hostId,pinType:t.type,direction:t.direction,extBinding:t.extBinding,isIgnored:e.isIgnored,isBreakpoint:e.isBreakpoint})}else{const a=p.forkedFrom||p,c=a.parent;if(0===c._type){const p=a.forkedAsJoint;if(p){const r=(null===(t=p.from)||void 0===t?void 0:t.hostId)||p.hostId,s=null===(i=e.startPin.parent)||void 0===i?void 0:i._key,a={id:e.id,type:"frame",frameKey:d,startPinParentKey:s,frameId:c.id,comId:null===(o=c.parent)||void 0===o?void 0:o.runtime.id,pinId:r,pinType:"joint",direction:p.direction,isIgnored:e.isIgnored,isBreakpoint:e.isBreakpoint};n.push(a);const f=`${a.comId?a.comId+"-":""}${a.frameId}`;u(p,f)}else{const t=null===(r=e.startPin.parent)||void 0===r?void 0:r._key,i=1===(null===(s=c.parent)||void 0===s?void 0:s._type)?c.parent.runtime.id:void 0;n.push({id:e.id,type:"frame",frameKey:d,startPinParentKey:t,frameId:c.id,comId:i,pinId:a.hostId,pinType:a.type,direction:a.direction,isIgnored:e.isIgnored,isBreakpoint:e.isBreakpoint})}}}}),n.length>0){let o;o=e.from&&e.from.hostId?e.from.hostId:e.hostId,i[`${t}-${o}`]=n}}};return e.varComAry&&e.varComAry.forEach(e=>{const i=e.runtime,o=i.def,r=[],d=[],p=i.geo,c=t?JSON.parse(JSON.stringify(i.model)):i.model;n[i.id]={id:i.id,def:o,title:i.title,model:c,reservedEditorAry:p?p.reservedEditorAry:void 0,configs:[],inputs:r,outputs:d},s.each(e=>{a(e,i.id),r.push(e.hostId)},e.inputPins,e.inputPinsInModel,e.inputPinExts),s.each(e=>{u(e,i.id),d.push(e.hostId)},e.outputPins,e.outputPinsInModel,e.outputPinExts,e.outputPinNexts)}),e.comAry&&e.comAry.forEach(e=>{const i=e.runtime,o=i.def,r=[],d=[],p=i.geo,c=t?JSON.parse(JSON.stringify(i.model)):i.model;n[i.id]={id:i.id,def:o,title:i.title,model:c,reservedEditorAry:p?p.reservedEditorAry:void 0,configs:[],inputs:r,outputs:d},s.each(e=>{a(e,i.id),r.push(e.hostId)},e.inputPins,e.inputPinsInModel,e.inputPinExts),s.each(e=>{u(e,i.id),d.push(e.hostId)},e.outputPins,e.outputPinsInModel,e.outputPinExts,e.outputPinNexts)}),e.frames&&e.frames.forEach(e=>{if("fx"===e.type){const n=d.toFrameJSON(e,void 0,t);p.push(n)}}),{comsReg:n,consReg:i,pinRels:o,pinProxies:r,fxFrames:p}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parsePage=t.parseProject=void 0;const i=n(6);let o,r;t.parseProject=function(e){return p(e[i.KEY_STAGEVIEW])},t.parsePage=function(e){return p(e)};let s="_F_",d="_R_";function p(e){if(!e||"object"!=typeof e||"object"!=typeof e.def||"object"!=typeof e.refs)return e;const{def:t,refs:n,D:i,consts:p}=e;if(p)s="_from_",d="_ref_",o={C:p.froms,W:{}};else if(i)if(i.W){const e={};Object.keys(i.W).forEach(t=>{e[i.W[t]]=t}),i.W=e,o=i}else o=Object.assign({W:{}},i);else o={C:{},W:{}};r={refs:n,didMap:{}};return a(t)}function a(e,t){const{refs:n,didMap:p}=r;let a=[];function c(e,t){if(Array.isArray(e))return e.forEach((t,n)=>{a.push(i=>{e[n]=i(t)})}),e;let r=e;if("object"==typeof r&&r){if(r[i.META_HASHCODE])return p[r[i.META_HASHCODE]]=t||r,t||r;const c=r[d];if("string"==typeof c){if(!t&&p[c])return p[c];r=n[c],p[c]=t||r}let f,l;(l=e[s])&&(f=function(){}),delete r[s];let m=function(e,t){let n=[];do{if(e==Object.prototype||e==Function.prototype)break;try{n=n.concat(Object.getOwnPropertyNames(e))}catch(e){console.error(e)}}while(e=Object.getPrototypeOf(e));return n.filter(n=>{if(!t||t&&"function"!=typeof e[n])return"constructor"!=n&&!/^__.+/g.test(n)})}(r);if(m.length>0){const e=r[i.META_IGNORE];m.forEach(t=>{let n=o.W[t],s=r[t];if(n?(r[t]=void 0,delete r[t]):n=t,t===i.META_IGNORE)return;const d=u(r,n);d&&d.get&&!d.set||e&&e[n]||e&&e[n]||a.push(e=>{const t=e(s);let i;const o=u(r,n);if(!o||!o.get||o.set)if(f&&"function"==typeof(i=f.load)){let e=i(r,n,t);void 0!==e&&(r[n]=e)}else try{r[n]=t}catch(e){throw e}})})}}return r}const f=c(e,t);for(let e=0;e<a.length;e++)a[e](e=>c(e));return a=void 0,f}function u(e,t){let n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){let i=e;for(;void 0===n&&null!=(i=Object.getPrototypeOf(i))&&i!==Object.prototype;)n=Object.getOwnPropertyDescriptor(i,t)}return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TEMP_MERGEDATA=t.META_IGNORE=t.META_HASHCODE=t.PIN_KEYS=t.KEY_REF=t.KEY_STAGEVIEW=void 0,t.KEY_STAGEVIEW="xg.desn.stageview",t.KEY_REF="_R_",t.PIN_KEYS=["inputPins","outputPins","inputPinExts","outputPinsInModel","inputPinsInModel","outputPinExts"],t.META_HASHCODE="_hc_",t.META_IGNORE="_ignore_",t.TEMP_MERGEDATA="_merge_data_"}])}));