!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["file-parser"]=t():e["file-parser"]=t()}(this,(()=>(()=>{"use strict";var e={86:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.length=t.merge=t.find=t.each=void 0,t.each=function(e,...t){t.forEach((t=>{t&&t.forEach(((i,o)=>{e(i,o,t)}))}))},t.find=function(e,...t){let i;return t.find((t=>{if(t)return i=t.find((t=>e(t)))})),i},t.merge=function(...e){let t=[];return e.forEach((e=>{t=t.concat(e)})),t},t.length=function(...e){let t=0;return e.forEach((e=>{Array.isArray(e)&&(t+=e.length)})),t}},132:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parsePage=t.parseProject=void 0;const o=i(369);let n,r;t.parseProject=function(e){return a(e[o.KEY_STAGEVIEW])},t.parsePage=function(e){return a(e)};let s="_F_",d="_R_";function a(e){if(!e||"object"!=typeof e||"object"!=typeof e.def||"object"!=typeof e.refs)return e;const{def:t,refs:i,D:a,consts:u}=e;if(u)s="_from_",d="_ref_",n={C:u.froms,W:{}};else if(a)if(a.W){const e={};Object.keys(a.W).forEach((t=>{e[a.W[t]]=t})),a.W=e,n=a}else n=Object.assign({W:{}},a);else n={C:{},W:{}};return r={refs:i,didMap:{}},function(e,t){const{refs:i,didMap:a}=r;let u=[];function l(e,t){if(Array.isArray(e))return e.forEach(((t,i)=>{u.push((o=>{e[i]=o(t)}))})),e;let r=e;if("object"==typeof r&&r){if(r[o.META_HASHCODE])return a[r[o.META_HASHCODE]]=t||r,t||r;const l=r[d];if("string"==typeof l){if(!t&&a[l])return a[l];r=i[l],a[l]=t||r}let c,f;(f=e[s])&&(c=function(){}),delete r[s];let m=function(e,t){let i=[];do{if(e==Object.prototype||e==Function.prototype)break;try{i=i.concat(Object.getOwnPropertyNames(e))}catch(e){console.error(e)}}while(e=Object.getPrototypeOf(e));return i.filter((i=>{if(!t||t&&"function"!=typeof e[i])return"constructor"!=i&&!/^__.+/g.test(i)}))}(r);if(m.length>0){const e=r[o.META_IGNORE];m.forEach((t=>{let i=n.W[t],s=r[t];if(i?(r[t]=void 0,delete r[t]):i=t,t===o.META_IGNORE)return;const d=p(r,i);d&&d.get&&!d.set||e&&e[i]||e&&e[i]||u.push((e=>{const t=e(s);let o;const n=p(r,i);if(!n||!n.get||n.set)if(c&&"function"==typeof(o=c.load)){let e=o(r,i,t);void 0!==e&&(r[i]=e)}else try{r[i]=t}catch(e){throw e}}))}))}}return r}const c=l(e,t);for(let e=0;e<u.length;e++)u[e]((e=>l(e)));return u=void 0,c}(t)}function p(e,t){let i=Object.getOwnPropertyDescriptor(e,t);if(void 0===i){let o=e;for(;void 0===i&&null!=(o=Object.getPrototypeOf(o))&&o!==Object.prototype;)i=Object.getOwnPropertyDescriptor(o,t)}return i}},248:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getComDataJSON=void 0,t.getComDataJSON=function(e,{data:t}){if("mybricks.normal-pc.form-container"===e){const e={};for(const i in t)e[i]="items"===i?[]:t[i];return e}return t}},330:e=>{e.exports=JSON.parse('{"name":"@mybricks/file-parser","version":"1.1.1","description":"Parser for rxui file content","main":"index.min.js","scripts":{"test":"ts-node --transpileOnly ./_test/index.ts","build":"webpack --config ./scripts/webpack.build.js"},"repository":{"type":"git","url":"https://github.com/mybricks/rxui.git"},"publishConfig":{"access":"public","registry":"https://registry.npmjs.org"},"author":"CheMingjun","license":"ISC","devDependencies":{"@babel/core":"^7.8.7","@babel/plugin-proposal-class-properties":"^7.8.3","@babel/preset-env":"^7.8.7","@babel/preset-react":"^7.8.3","@testing-library/react":"^11.2.5","@types/node":"^13.9.0","@types/react":"^18.0.21","@types/react-dom":"^18.0.6","babel-loader":"^8.0.6","core-js":"^2.6.11","jest":"^29.7.0","rimraf":"^2.6.2","ts-loader":"^6.2.1","ts-node":"^10.9.1","typescript":"^3.8.3","webpack":"^5.98.0","webpack-bundle-analyzer":"^4.10.2","webpack-cli":"^6.0.1"}}')},369:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.COM_NS_MODULE=t.COM_NS_SELECTION=t.COM_NS_VAR=t.COM_NS_SCENE=t.COM_NS_FX=t.TEMP_MERGEDATA=t.META_IGNORE=t.META_HASHCODE=t.PIN_KEYS=t.KEY_REF=t.KEY_STAGEVIEW=void 0,t.KEY_STAGEVIEW="xg.desn.stageview",t.KEY_REF="_R_",t.PIN_KEYS=["inputPins","outputPins","inputPinExts","outputPinsInModel","inputPinsInModel","outputPinExts"],t.META_HASHCODE="_hc_",t.META_IGNORE="_ignore_",t.TEMP_MERGEDATA="_merge_data_",t.COM_NS_FX="mybricks.core-comlib.fn",t.COM_NS_SCENE="mybricks.core-comlib.scenes",t.COM_NS_VAR="mybricks.core-comlib.var",t.COM_NS_SELECTION="mybricks.core-comlib.selection",t.COM_NS_MODULE="mybricks.core-comlib.module"},495:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getToplSource=void 0;const o=i(369);function n(e){var t,i;const r=[],s=[],d=[],a=[],p=[];let u;if(u=0===(null===(t=e.parent)||void 0===t?void 0:t._type)?e.isTypeOfFx()?"fx":"frame":(null===(i=e.parent)||void 0===i?void 0:i.runtime)?"com":"scene",e.inputPins&&e.inputPins.forEach((e=>{r.push({pinId:e.hostId,title:e.title,type:e.type,schema:e.schema,extValues:e.extValues})})),e.outputPins&&e.outputPins.forEach((e=>{s.push({id:e.hostId,title:e.title,type:e.type,schema:e.schema})})),e.frameAry&&e.frameAry.forEach((e=>{if(e.diagramAry.length>0){const t=n(e);d.push(t)}})),e.diagramAry&&e.diagramAry.forEach((e=>{const t=function(e){if(e.conAry.length<=0)return;const t=[],i=[],n={id:e.id,title:e.title,comAry:t,connections:i};return e.startWithCom&&(n.type="event",n.from={com:{id:e.startWithCom.id,title:e.startWithCom.runtime.title,pinId:e.startWithCom.outputPins[0].hostId}}),e.comAry.length>0&&e.comAry.forEach((e=>{let i;i=e.runtime.geo?"ui":e.runtime.def.namespace===o.COM_NS_SCENE?"scene":e.runtime.def.namespace===o.COM_NS_VAR?"var":e.runtime.def.namespace===o.COM_NS_FX?"fx":"js";const n=function(e){const t=[];return e.inputPins&&e.inputPins.forEach((e=>{t.push({id:e.hostId,title:e.title})})),e.inputPinsInModel&&e.inputPinsInModel.forEach((e=>{t.push({id:e.hostId,title:e.title})})),e.inputPinExts&&e.inputPinExts.forEach((e=>{t.push({id:e.hostId,title:e.title})})),t}(e),r=function(e){const t=[];return e.outputPins&&e.outputPins.forEach((e=>{t.push({id:e.hostId,title:e.title})})),e.outputPinsInModel&&e.outputPinsInModel.forEach((e=>{t.push({id:e.hostId,title:e.title})})),e.outputPinExts&&e.outputPinExts.forEach((e=>{t.push({id:e.hostId,title:e.title})})),t}(e),s={id:e.id,title:e.runtime.title,namespace:e.runtime.def.namespace,type:i,style:e.style,inputs:n,outputs:r};e.runtime.hasUI()||(s.data=e.runtime.model.data),t.push(s)})),e.conAry.forEach((e=>{const t=e.startPin,o=e.finishPin,n={from:{com:{id:t.parent.id,title:t.parent.runtime.title},pin:{id:t.hostId,title:t.title,position:e.startPo}},to:{com:{id:o.parent.id,title:o.parent.runtime.title},pin:{id:o.hostId,title:o.title,position:e.finishPo}}};i.push(n)})),n}(e);t&&a.push(t)})),e.comAry&&e.comAry.forEach((e=>{const t=function(e){if(e.frames){const t=[];if(e.frames.forEach((e=>{const i=n(e);i&&t.push(i)})),t.length>0)return{id:e.id,title:e.runtime.title,frameAry:t}}}(e);t&&p.push(t)})),a.length<=0&&d.length<=0&&p.length<=0)return;const l={id:e.id,title:e.diagramAry[0].title,type:u};return p.length>0&&(l.comAry=p),a.length>0&&(l.diagrams=a),e.comAry&&p.length>0&&(l.comAry=p),d.length>0&&(l.frames=d),l}t.getToplSource=function(e){const t={scenes:[]};return e.frames&&e.frames.forEach((e=>{const i=n(e);i&&t.scenes.push(i)})),t}},547:function(e,t,i){var o=this&&this.__createBinding||(Object.create?function(e,t,i,o){void 0===o&&(o=i),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,o){void 0===o&&(o=i),e[o]=t[i]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.hasOwnProperty.call(e,i)&&o(t,e,i);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.toJSON=void 0;const s=r(i(86)),d=i(592);t.toJSON=function(e,t){const i={},o={},n={},r={},a=[],p=(e,i)=>{if(e.proxyPin)if(e.proxyPin._todo_){const{frameId:t,pinId:o,pinHostId:n}=e.proxyPin;r[`${i}-${e.hostId}`]={type:"frame",frameId:t,pinId:n}}else{const t=e.proxyPin.parent;if(t&&0===t._type){const o=t.id;r[`${i}-${e.hostId}`]={type:"frame",frameId:o,pinId:e.proxyPin.hostId}}}if(e.conAry){const n=[];if(e.conAry.forEach((e=>{var i,o,r,s,d;let a;const u=e.finishPin;if(!u)return;if(n.find((t=>t.id===e.id)))return;let l;u.parent.timerInputPin&&(l=u.parent.timerInputPin.id);const c=e.parent.parent;c&&(a=c.parent?1===c.parent._type?`${c.parent.runtime.id}-${c.id}`:`${c.id}`:"_rootFrame_");const f=u.parent;if(1===f._type){const i=u.forkedFrom||u,o=f.forkedFrom||f,r=e.startPin.parent._key,s=e.finishPin.parent._key;n.push({id:e.id,type:"com",frameKey:a,startPinParentKey:r,finishPinParentKey:s,comId:o.runtime.id,def:o.runtime.def,timerPinInputId:l,pinId:i.hostId,pinType:i.type,direction:i.direction,extBinding:i.extBinding,isIgnored:(null==t?void 0:t.forDebug)?e.isIgnored:void 0,isBreakpoint:(null==t?void 0:t.forDebug)?e.isBreakpoint:void 0})}else{const l=u.forkedFrom||u,c=l.parent;if(0===c._type){const u=l.forkedAsJoint;if(u){const s=(null===(i=u.from)||void 0===i?void 0:i.hostId)||u.hostId,d=null===(o=e.startPin.parent)||void 0===o?void 0:o._key,l={id:e.id,type:"frame",frameKey:a,startPinParentKey:d,frameId:c.id,comId:null===(r=c.parent)||void 0===r?void 0:r.runtime.id,pinId:s,pinType:"joint",direction:u.direction,isIgnored:(null==t?void 0:t.forDebug)?e.isIgnored:void 0,isBreakpoint:(null==t?void 0:t.forDebug)?e.isBreakpoint:void 0};n.push(l);const f=`${l.comId?l.comId+"-":""}${l.frameId}`;p(u,f)}else{const i=null===(s=e.startPin.parent)||void 0===s?void 0:s._key,o=1===(null===(d=c.parent)||void 0===d?void 0:d._type)?c.parent.runtime.id:void 0;n.push({id:e.id,type:"frame",frameKey:a,startPinParentKey:i,frameId:c.id,comId:o,pinId:l.hostId,pinType:l.type,direction:l.direction,isIgnored:(null==t?void 0:t.forDebug)?e.isIgnored:void 0,isBreakpoint:(null==t?void 0:t.forDebug)?e.isBreakpoint:void 0})}}}})),n.length>0){let t;t=e.from&&e.from.hostId?e.from.hostId:e.hostId,o[`${i}-${t}`]=n}}};return e&&(e.varComAry&&e.varComAry.forEach((e=>{const o=e.runtime,d=o.def,a=[],u=[],l=o.geo,c=(null==t?void 0:t.needClone)?JSON.parse(JSON.stringify(o.model)):o.model;i[o.id]={id:o.id,def:d,title:o.title,model:c,reservedEditorAry:l?l.reservedEditorAry:void 0,configs:[],inputs:a,outputs:u},s.each((e=>{((e,t)=>{if(e.rels&&(n[`${t}-${e.hostId}`]=e.rels),e.proxyPin)if(e.proxyPin._todo_){const{frameId:i,pinId:o,pinHostId:n}=e.proxyPin;r[`${t}-${e.hostId}`]={type:"frame",frameId:i,pinId:n}}else{const i=e.proxyPin.parent;if(i&&0===i._type){const o=i.id;r[`${t}-${e.hostId}`]={type:"frame",frameId:o,pinId:e.proxyPin.hostId}}}})(e,o.id),a.push(e.hostId)}),e.inputPins,e.inputPinsInModel,e.inputPinExts),s.each((e=>{p(e,o.id),u.push(e.hostId)}),e.outputPins,e.outputPinsInModel,e.outputPinExts,e.outputPinNexts)})),e.frames&&e.frames.forEach((e=>{if(!e.bizType||"ui"===e.bizType){if("fx"===e.type){const i=d.toFrameJSON(e,{},t);a.push(i)}if("extension"===e.type){const i=d.toFrameJSON(e,{},t);a.push(i)}}}))),{comsReg:i,consReg:o,pinRels:n,pinProxies:r,fxFrames:a}}},592:function(e,t,i){var o=this&&this.__createBinding||(Object.create?function(e,t,i,o){void 0===o&&(o=i),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,o){void 0===o&&(o=i),e[o]=t[i]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.hasOwnProperty.call(e,i)&&o(t,e,i);return n(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.toFrameJSON=t.toSlotJSON=t.toJSON=void 0;const d=r(i(86)),a=s(i(330)),p=i(714),u=i(369);function l(e,{depsReg:t,comsReg:i},o,n){let r;const s=e=>{if(e.comAry){const r=[];e.comAry.forEach((e=>{var d;const a=e.runtime;if(!o){const o=a.def;if(o.namespace===u.COM_NS_SELECTION)return;if(o.namespace===u.COM_NS_MODULE){const i=e.proxySlot.id;t.find((e=>e.namespace===o.namespace&&e.version===o.version&&e.moduleId===i))||t.push(Object.assign(Object.assign({},o),{moduleId:i}))}else t.find((e=>e.namespace===o.namespace&&e.version===o.version))||t.push(o);const r=n.needClone?JSON.parse(JSON.stringify(a.model)):a.model,s={},p=null===(d=a.geo.parent)||void 0===d?void 0:d.style;"absolute"!==(null==p?void 0:p.layout)&&"smart"!==(null==p?void 0:p.layout)||(delete r.style.marginTop,delete r.style.marginRight,delete r.style.marginBottom,delete r.style.marginLeft),r.style?("absolute"===r.style.position&&(s.position="absolute"),s.width=r.style.widthFact,s.height=r.style.heightFact):r.style={},i[a.id]={id:a.id,def:o,name:e.name,title:a.title,style:s,model:r}}let p;if(e.slots&&(p={},e.slots.forEach((e=>{const t=s(e);t&&(p[e.id]=t)}))),a.topl){const e=a.topl;e.frames&&e.frames.forEach((e=>{p=p||{},p[e.id]||(p[e.id]={id:e.id,title:e.title,type:e.type,comAry:[],style:{}})}))}r.push({id:e.runtime.id,name:e.name,def:e.runtime.def,slots:p})}));const d=e.style.widthFact,a=e.style.heightFact,p=Object.assign({},e.style,{width:d,height:a});return delete p.left,delete p.top,delete p.zoom,delete p.marginLeft,delete p.marginRight,{id:e.id,title:e.title,type:e.type,showType:e.showType,layoutTemplate:e.layoutTemplate,comAry:r,style:p}}};return e&&(r=s(e)),r}function c(e,t,i){const o=t.depsReg||[],n=t.comsReg||{},r=[],s=[],l=[],c=[],m={},y={},h={},v={},g={},I=(e,t)=>{var i;if(e.rels)m[`${t}-${e.hostId}`]=e.rels;else if(1===e.parent._type){const o=e.parent;if(o.runtime.def.namespace===u.COM_NS_MODULE){const n=o.ioProxyForCall;if(n&&n.frame){const o=null===(i=n.frame.inputPins)||void 0===i?void 0:i.find((t=>t.id===e.hostId));o&&o.rels&&(m[`${t}-${e.hostId}`]=o.rels)}}}if(e.proxyScenePin){const{sceneId:i,hostId:o}=e.proxyScenePin;y[`${t}-${e.hostId}`]={type:"frame",frameId:i,pinId:o}}if(e.proxyMyFramePin){const{frameId:i,pinId:o}=e.proxyMyFramePin;y[`${t}-${e.hostId}`]={type:"myFrame",frameId:i,pinId:o}}if(e.proxyPin)if(e.proxyPin._todo_){const{frameId:i,pinId:o,pinHostId:n}=e.proxyPin;y[`${t}-${e.hostId}`]={type:"frame",frameId:i,pinId:n}}else{const i=e.proxyPin.parent;if(i&&0===i._type){const o=i.id;y[`${t}-${e.hostId}`],y[`${t}-${e.hostId}`]={type:"frame",frameId:o,pinId:e.proxyPin.hostId}}}if(e.proxyPinValue){const i=e.proxyPinValue.parent;if(i&&0===i._type){const o=i.id;h[`${t}-${e.hostId}`]={type:"frame",frameId:o,pinId:e.proxyPinValue.hostId}}}e.editor},P=(e,t)=>{var o;if(e.proxyPin)if(e.proxyPin._todo_){const{frameId:i,pinId:o,pinHostId:n}=e.proxyPin;y[`${t}-${e.hostId}`]={type:"frame",frameId:i,pinId:n}}else{const i=e.proxyPin.parent;if(i&&0===i._type){const o=i.id;y[`${t}-${e.hostId}`]={type:"frame",frameId:o,pinId:e.proxyPin.hostId}}}if((null===(o=e.conAry)||void 0===o?void 0:o.length)>0){const o=[];if(e.conAry.forEach((e=>{var t,n,r,s,d,a,p,u;let l,c;const m=e.finishPin;if(!m)return;if(o.find((t=>t.id===e.id)))return;let y;m.parent,m.parent&&m.parent.timerInputPin&&(y=m.parent.timerInputPin.id);const h=null===(t=e.parent)||void 0===t?void 0:t.parent;h&&(l=f(h)),c=m.proxyPinValue?f(m.proxyPinValue.parent):l;const v=m.parent;if(1===(null==v?void 0:v._type)){const t=m.forkedFrom||m,s=v.forkedFrom||v;if(s&&(s.runtime||s._todo_&&s.comId)){const d=(null===(n=s.runtime)||void 0===n?void 0:n.id)||s.comId,a=(null===(r=s.runtime)||void 0===r?void 0:r.def)||s.def,p=e.startPin.parent._key,u=e.finishPin.parent._key,f={id:e.id,type:"com",frameKey:l,targetFrameKey:c,startPinParentKey:p,finishPinParentKey:u,comId:d,def:a,timerPinInputId:y,pinId:t.hostId,pinType:t.type,direction:t.direction,extBinding:t.extBinding,isIgnored:(null==i?void 0:i.forDebug)?e.isIgnored:void 0,isBreakpoint:(null==i?void 0:i.forDebug)?e.isBreakpoint:void 0};e.startPin.isStarter&&delete f.startPinParentKey,o.push(f)}}else{const t=m.forkedFrom||m,n=t.parent;if(0===n._type){const r=t.forkedAsJoint;if(r){const t=(null===(s=r.from)||void 0===s?void 0:s.hostId)||r.hostId,p=null===(d=e.startPin.parent)||void 0===d?void 0:d._key,u={id:e.id,type:"frame",frameKey:l,startPinParentKey:p,frameId:n.id,comId:null===(a=n.parent)||void 0===a?void 0:a.runtime.id,pinId:t,pinType:"joint",direction:r.direction,isIgnored:(null==i?void 0:i.forDebug)?e.isIgnored:void 0,isBreakpoint:(null==i?void 0:i.forDebug)?e.isBreakpoint:void 0};o.push(u);const c=`${u.comId?u.comId+"-":""}${u.frameId}`;P(r,c)}else{const r=null===(p=e.startPin.parent)||void 0===p?void 0:p._key,s=1===(null===(u=n.parent)||void 0===u?void 0:u._type)?n.parent.runtime.id:void 0;o.push({id:e.id,type:"frame",frameKey:l,startPinParentKey:r,frameId:n.id,comId:s,pinId:t.hostId,pinType:t.type,direction:t.direction,isIgnored:(null==i?void 0:i.forDebug)?e.isIgnored:void 0,isBreakpoint:(null==i?void 0:i.forDebug)?e.isBreakpoint:void 0})}}}})),o.length>0){let i;i=e.from&&e.from.hostId?e.from.hostId:e.hostId,v[`${t}-${i}`]=o}}},_=e=>{const t={id:e.id,title:e.title,_inputs:[],_outputs:[],inputs:[],outputs:[]};return e._inputPins&&e._inputPins.forEach((o=>{let n;n=e.parent&&1===e.parent._type?`${e.parent.runtime.id}-${e.id}`:e.parent?e.id:"_rootFrame_",P(o,n),I(o,n),e.parent||r.push({id:o.hostId,title:o.title,type:o.type,schema:i.withIOSchema?o.schema:void 0,extValues:o.extValues}),t._inputs.push({id:o.hostId,title:o.title,type:o.type,schema:i.withIOSchema?o.schema:void 0,extValues:o.extValues})})),e.inputPins&&e.inputPins.forEach((o=>{let n;n=e.parent&&1===e.parent._type?`${e.parent.runtime.id}-${e.id}`:e.parent?e.id:"_rootFrame_",P(o,n),I(o,n),e.parent||l.push({id:o.hostId,title:o.title,type:o.type,schema:i.withIOSchema?o.schema:void 0,extValues:o.extValues,mockData:i.withMockData?o.mockData:void 0,mockDataType:i.withMockData?o.mockDataType:void 0,editor:o.editor}),t.inputs.push({id:o.hostId,title:o.title,type:o.type,schema:i.withIOSchema?o.schema:void 0,extValues:o.extValues,mockData:i.withMockData?o.mockData:void 0,mockDataType:i.withMockData?o.mockDataType:void 0,editor:o.editor})})),e._outputPins&&e._outputPins.forEach((o=>{e.parent||s.push({id:o.hostId,title:o.title,type:o.type,schema:i.withIOSchema?o.schema:void 0}),t._outputs.push({id:o.hostId,title:o.title,type:o.type,schema:i.withIOSchema?o.schema:void 0})})),e.outputPins&&e.outputPins.forEach((o=>{e.parent||c.push({id:o.hostId,title:o.title,type:o.type,schema:i.withIOSchema?o.schema:void 0}),("event"===o.type||"shortcut"===o.type)&&P(o,"_rootFrame_"),t.outputs.push({id:o.hostId,title:o.title,type:o.type,schema:i.withIOSchema?o.schema:void 0})})),e.comAry&&e.comAry.forEach((t=>{var r,s,a,l,c,f,m,y;if(!t||!t.runtime)return;if(t.diagramModel){const e=t.diagramModel,i=e.parent;if(i&&i.diagramAry&&!i.diagramAry.find((t=>t.id===e.id)))return}const h=t.runtime,v=h.def;if(v.namespace===u.COM_NS_SELECTION)return;if(v.namespace===u.COM_NS_MODULE){const e=null===(s=null===(r=t.ioProxyForCall)||void 0===r?void 0:r.frame)||void 0===s?void 0:s.id;e&&(o.find((t=>t.namespace===v.namespace&&t.version===v.version&&t.moduleId===e))||o.push(Object.assign(Object.assign({},v),{moduleId:e})))}else o.find((e=>e.namespace===v.namespace&&e.version===v.version))||o.push(v);const O=[],b=[],S=[],E=[],x=h.geo;let N=i.needClone?JSON.parse(JSON.stringify(h.model)):h.model;N.extSourceCodes&&(i.needClone&&delete N.extSourceCodes,N.isAICode=!0),h.modelForToJSON&&(N=Object.assign({},N,h.modelForToJSON),h.modelForToJSON=void 0),Array.isArray(N.outputAry)&&(N.outputAry=N.outputAry.map((e=>e.hostId)));const A={};if(h.geo){const e=null===(a=h.geo.parent)||void 0===a?void 0:a.style;"absolute"!==(null==e?void 0:e.layout)&&"smart"!==(null==e?void 0:e.layout)||(delete N.style.marginTop,delete N.style.marginRight,delete N.style.marginBottom,delete N.style.marginLeft),N.style?("absolute"===N.style.position&&(A.position="absolute"),A.width=N.style.widthFact,A.height=N.style.heightFact):N.style={}}if(delete N.inputAry,delete N.outputAry,t.ioProxy&&0===t.ioProxy._type){let e;t.ioProxy.inputPins.forEach((t=>{var i,o;"config"===t.type&&(null===(o=null===(i=t.extValues)||void 0===i?void 0:i.config)||void 0===o?void 0:o.defaultValue)&&(e=e||{},e[t.hostId]=t.extValues.config.defaultValue)})),e&&(N.data.configs=e)}let M;v.namespace===u.COM_NS_FX&&(M={id:null===(l=t.ioProxy)||void 0===l?void 0:l.id,type:"fx"});const j={id:h.id,def:v,isTemp:h.isTemp,frameId:e.parent?e.id:void 0,parentComId:null===(f=null===(c=e.parent)||void 0===c?void 0:c.runtime)||void 0===f?void 0:f.id,title:h.title,model:N,style:A,asRoot:x?x.asRoot:void 0,reservedEditorAry:x?x.reservedEditorAry:void 0,configs:O,_inputs:b,inputs:S,outputs:E,frames:void 0,ioProxy:M};if(n[h.id]=j,i.onlyDiff){const e=i.onlyDiff.getComDef(v);if(e){const t=e.data;N.data=p.getJSONDiff(N.data,t),(null===(m=v.rtType)||void 0===m?void 0:m.match(/^js/))||(delete n[h.id].inputs,delete n[h.id].outputs),delete n[h.id].configs,delete n[h.id]._inputs}}if(t.configPins&&t.configPins.forEach((e=>{O.push(e.hostId)})),t.timerInput&&(I(t.timerInput,h.id),n[h.id].timerInput=t.timerInput.hostId),d.each((e=>{I(e,h.id),b.push(e.hostId)}),t._inputPins),d.each((e=>{I(e,h.id),S.push(e.hostId)}),t.inputPins,t.inputPinsInModel,t.inputPinExts,t.inputPinExtForFrames),d.each((e=>{P(e,h.id),E.push(e.hostId)}),t.outputPins,t.outputPinsInModel,t.outputPinExts,t.outputPinNexts),h._autoRun&&(null===(y=v.rtType)||void 0===y?void 0:y.match(/^js/))){let t;t=e.parent?e.parent.runtime?`${e.parent.runtime.id}-${e.id}`:e.id:"_rootFrame_";let i=g[t];i||(i=g[t]=[]),i.push({id:h.id,def:v})}if(t.frames){const e=j.frames=[];t.frames.forEach((t=>{const i=_(t);e.push(i)}))}})),e.frameAry&&e.frameAry.forEach((e=>{e.hostFrameId||_(e)})),t};return e&&_(e),{"-v":a.default.version,id:e.id,name:e.name,title:e.title,type:e.type,deps:o,coms:n,comsAutoRun:g,_inputs:r,_outputs:s,inputs:l,outputs:c,cons:v,pinRels:m,pinProxies:y,pinValueProxies:h}}function f(e){if(e)return e.parent?1===e.parent._type?`${e.parent.runtime.id}-${e.id}`:`${e.id}`:"_rootFrame_"}t.toJSON=function({slot:e,frame:t},i){const o=[],n={};let r,s;return e&&(r=l(e,{depsReg:o,comsReg:n},t,i)),t&&(s=c(t,{depsReg:o,comsReg:n},i)),Object.assign({"-v":a.default.version,deps:o,coms:n},s||{},r?{id:r.id,title:r.title,slot:r}:{})},t.toSlotJSON=l,t.toFrameJSON=c},671:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSlotPrompts=void 0;const o=i(248);t.getSlotPrompts=function(e){const t=e=>{if(e.comAry){const i=[];e.comAry.forEach((e=>{const n=e.runtime,r=n.def,s=n.model;let d;e.slots&&(d={},e.slots.forEach((e=>{d[e.id]=t(e)})));const a={id:n.id,name:e.name,title:n.title,namespace:r.namespace,version:r.version,style:s.style,data:s.data,slots:d};a.data=o.getComDataJSON(r.namespace,{data:s.data}),i.push(a)}));const n=e.style.widthFact,r=e.style.heightFact,s=Object.assign({},e.style,{width:n,height:r}),d={id:e.id,title:e.title,type:e.type,showType:e.showType,comAry:i,style:s};if("scope"===e.type&&e.parent.runtime){const t=e.parent.runtime.topl;if(t){const i=t.frames.find((t=>t.id===e.id));if(i){const e={};if(i.inputPins){const t=[];i.inputPins.forEach((e=>{t.push({id:e.id,hostId:e.hostId,title:e.title,direction:e.direction,schema:e.schema})})),e.inputs=t}if(i.outputPins){const t=[];i.outputPins.forEach((e=>{t.push({id:e.id,hostId:e.hostId,title:e.title,direction:e.direction,schema:e.schema})})),e.outputs=t}d.interactions=e}}}return d}};let i;return e&&(i=t(e)),i}},714:(e,t)=>{function i(e,t){if(!t)return e;let i;for(let n in e){const r=o(e[n],t[n]);void 0!==r&&(i||(i={}),i[n]=r)}return i}function o(e,t){return Array.isArray(e)?Array.isArray(t)?e.length!==t.length||e.find(((e,i)=>{if(void 0!==o(e,t[i]))return!0}))?e:void 0:e:"object"==typeof e?i(e,t):e!==t?e:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.getJSONDiff=void 0,t.getJSONDiff=i},739:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getPageTemplateJSON=void 0;const o=i(671),n=i(495);t.getPageTemplateJSON=function(e){if(e){const{slot:t,frame:i}=e,r={},s=t.slots.map((e=>o.getSlotPrompts(e)));r.ui=s;const d=n.getToplSource(i);return r.interactions=d,r}}},743:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toJSON=void 0;const o=i(592);t.toJSON=function(e,t){const i=[];return e.frames&&e.frames.forEach((e=>{if("service"===e.bizType){const n=o.toFrameJSON(e,{},t);i.push(n)}})),{comsReg:{},consReg:{},pinRels:{},pinProxies:{},frames:i}}}},t={};function i(o){var n=t[o];if(void 0!==n)return n.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,i),r.exports}var o={};return(()=>{var e=o;Object.defineProperty(e,"__esModule",{value:!0}),e.parseProject=e.parsePage=e.toJSONFromProjectDump=e.getPageTemplateJSONFromDumpJson=e.toJSONFromPageDump=e.getJSONFromModule=e.getServiceJSON=e.getGlobalJSON=void 0;const t=i(592),n=i(547),r=i(743),s=i(132);Object.defineProperty(e,"parsePage",{enumerable:!0,get:function(){return s.parsePage}}),Object.defineProperty(e,"parseProject",{enumerable:!0,get:function(){return s.parseProject}});const d=i(739);var a=i(739);function p(e,i){if(null==i?void 0:i.forMPA){const{slot:o,frame:n}=e,r=[t.toJSON({slot:o,frame:n},i||{})];return o.slots&&o.slots.length>0&&o.slots.forEach(((e,o)=>{const s=null==n?void 0:n.frameAry.find((t=>{if(t.id===e.id)return t}));r.push(t.toJSON({slot:e,frame:s},i||{}))})),r}return t.toJSON(e,i||{})}Object.defineProperty(e,"getPageTemplateJSON",{enumerable:!0,get:function(){return a.getPageTemplateJSON}}),e.getGlobalJSON=function(e,t){return n.toJSON(e,t||{})},e.getServiceJSON=function(e,t){return r.toJSON(e,t||{})},e.getJSONFromModule=p,e.toJSONFromPageDump=function(e,t){const i=JSON.parse(e).content;return p(s.parsePage(i),t)},e.getPageTemplateJSONFromDumpJson=function(e,t){var i,o;const n=null===(i=JSON.parse(e))||void 0===i?void 0:i.content,r=null===(o=s.parsePage(null==n?void 0:n["xg.desn.stageview"]))||void 0===o?void 0:o.mainModule;return d.getPageTemplateJSON(r)},e.toJSONFromProjectDump=function(e){let t;"string"==typeof e?t=JSON.parse(e):"object"==typeof e&&(t=e.projectContent);const i=s.parseProject(t),{mainModule:o,pluginDataset:n}=i;return p({slot:o.slot,frame:o.frame,pluginDataset:n})}})(),o})()));